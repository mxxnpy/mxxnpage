import{b as P}from"./chunk-MJNAK4YN.js";import{$ as y,Ca as C,Ga as k,Ja as g,L as x,Pa as l,Qa as b,Sa as t,Ta as n,Ua as s,Va as S,Wa as T,Xa as m,aa as _,ab as a,ba as u,bb as d,ca as f,rb as w,sb as M,wa as h,x as v,ya as i}from"./chunk-ADBPSF2C.js";function E(r,p){r&1&&(t(0,"div",3),u(),t(1,"svg",4)(2,"path",5),s(3,"animateTransform",6),n()(),f(),t(4,"span"),a(5,"Loading current track..."),n()())}function O(r,p){if(r&1){let e=S();t(0,"div",3),u(),t(1,"svg",4),s(2,"path",7),n(),f(),t(3,"span"),a(4,"Authentication required"),n(),t(5,"button",8),T("click",function(){y(e);let o=m();return _(o.authenticate())}),a(6,"Connect"),n()()}}function A(r,p){if(r&1&&(t(0,"div",9),u(),t(1,"svg",4),s(2,"path",10),n(),f(),t(3,"span"),a(4),n()()),r&2){let e=m();i(4),d(e.error)}}function V(r,p){r&1&&(t(0,"div",3),u(),t(1,"svg",4),s(2,"path",11),n(),f(),t(3,"span"),a(4,"Not currently playing anything"),n()())}function H(r,p){if(r&1&&(t(0,"div",28),s(1,"img",29),n()),r&2){let e=m(2);i(),l("src",e.currentTrack.album.images[0].url,h)("alt",e.currentTrack.album==null?null:e.currentTrack.album.name)}}function L(r,p){if(r&1&&(t(0,"div",30),a(1),n()),r&2){let e=m(2);i(),d(e.currentTrack.album.name)}}function z(r,p){if(r&1&&(t(0,"a",31),a(1," Open in Spotify "),n()),r&2){let e=m(2);l("href",e.currentTrack.external_urls.spotify,h)}}function N(r,p){if(r&1&&(t(0,"div",12)(1,"div",13),u(),t(2,"svg",4),s(3,"path",14),n(),f(),t(4,"span"),a(5,"Now Playing"),n()(),t(6,"div",15),g(7,H,2,2,"div",16),t(8,"div",17)(9,"div",18),a(10),n(),t(11,"div",19),a(12),n(),g(13,L,2,1,"div",20),t(14,"div",21)(15,"div",22),s(16,"div",23),n(),t(17,"div",24)(18,"span",25),a(19),n(),t(20,"span",26),a(21),n()()(),g(22,z,2,1,"a",27),n()()()),r&2){let e=m();i(7),l("ngIf",(e.currentTrack.album==null?null:e.currentTrack.album.images)&&e.currentTrack.album.images.length>0),i(3),d(e.currentTrack.name),i(2),d(e.getArtistNames(e.currentTrack.artists)),i(),l("ngIf",e.currentTrack.album),i(3),b("width",e.progressPercentage,"%"),i(3),d(e.formatTime(e.currentTrack.progress_ms)),i(2),d(e.formatTime(e.currentTrack.duration_ms)),i(),l("ngIf",e.currentTrack.external_urls==null?null:e.currentTrack.external_urls.spotify)}}var F=(()=>{class r{constructor(e){this.spotifyService=e,this.currentTrack=null,this.loading=!0,this.error=null,this.progressPercentage=0,this.refreshInterval=1e4,this.subscription=null}ngOnInit(){this.loadCurrentTrack(),this.subscription=v(this.refreshInterval).pipe(x(()=>this.spotifyService.getNowPlaying())).subscribe({next:e=>this.updateCurrentTrack(e),error:e=>{console.error("Error refreshing current track:",e)}})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}authenticate(){window.location.href=`${window.location.origin.replace("4202","3000")}/backend/spotify/auth/login`}loadCurrentTrack(){this.loading=!0,this.error=null,this.spotifyService.getNowPlaying().subscribe({next:e=>{e?this.updateCurrentTrack(e):this.error="No track currently playing",this.loading=!1},error:e=>{console.error("Error loading current track:",e),e.status===401?this.error="401: Authentication required":this.error="Failed to load current track",this.loading=!1}})}updateCurrentTrack(e){e?e.item?(this.currentTrack=e.item,this.currentTrack.progress_ms=e.progress_ms||0,this.progressPercentage=e.progress_ms/e.item.duration_ms*100):e.name&&e.artists?(this.currentTrack=e,this.currentTrack.progress_ms=e.progress_ms||0,this.progressPercentage=e.progress_ms/e.duration_ms*100):(this.currentTrack=null,this.progressPercentage=0):(this.currentTrack=null,this.progressPercentage=0)}getArtistNames(e){return!e||e.length===0?"":e.map(c=>c.name).join(", ")}formatTime(e){if(!e)return"0:00";let c=Math.floor(e/1e3),o=Math.floor(c/60),I=c%60;return`${o}:${I.toString().padStart(2,"0")}`}static{this.\u0275fac=function(c){return new(c||r)(C(P))}}static{this.\u0275cmp=k({type:r,selectors:[["app-spotify-player"]],decls:5,vars:5,consts:[["class","status-item",4,"ngIf"],["class","status-item error",4,"ngIf"],["class","now-playing",4,"ngIf"],[1,"status-item"],["viewBox","0 0 24 24","width","24","height","24",1,"icon"],["fill","currentColor","d","M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"],["attributeName","transform","attributeType","XML","type","rotate","from","0 12 12","to","360 12 12","dur","1s","repeatCount","indefinite"],["fill","currentColor","d","M12,2C6.477,2 2,6.477 2,12C2,17.523 6.477,22 12,22C17.523,22 22,17.523 22,12C22,6.477 17.523,2 12,2M12,4C16.418,4 20,7.582 20,12C20,16.418 16.418,20 12,20C7.582,20 4,16.418 4,12C4,7.582 7.582,4 12,4M15,12L11,16V8L15,12Z"],[1,"connect-button",3,"click"],[1,"status-item","error"],["fill","currentColor","d","M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"],["fill","currentColor","d","M12,3V12.26C11.5,12.09 11,12 10.5,12C8.56,12 7,13.56 7,15.5C7,17.44 8.56,19 10.5,19C12.44,19 14,17.44 14,15.5V6H18V3H12Z"],[1,"now-playing"],[1,"now-playing-header"],["fill","currentColor","d","M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M10,16.5L16,12L10,7.5V16.5Z"],[1,"track-container"],["class","album-art",4,"ngIf"],[1,"track-info"],[1,"track-name"],[1,"track-artist"],["class","track-album",4,"ngIf"],[1,"track-progress"],[1,"progress-bar-container"],[1,"progress-bar"],[1,"time-info"],[1,"current-time"],[1,"duration"],["target","_blank","class","spotify-link",3,"href",4,"ngIf"],[1,"album-art"],[3,"src","alt"],[1,"track-album"],["target","_blank",1,"spotify-link",3,"href"]],template:function(c,o){c&1&&g(0,E,6,0,"div",0)(1,O,7,0,"div",0)(2,A,5,1,"div",1)(3,V,5,0,"div",0)(4,N,23,9,"div",2),c&2&&(l("ngIf",o.loading),i(),l("ngIf",o.error&&o.error.includes("401")),i(),l("ngIf",o.error&&!o.error.includes("401")),i(),l("ngIf",!o.loading&&!o.error&&!o.currentTrack),i(),l("ngIf",!o.loading&&!o.error&&o.currentTrack))},dependencies:[M,w],styles:[".connect-button[_ngcontent-%COMP%]{background-color:transparent;color:var(--accent-color);border:1px solid var(--border-color);padding:.25rem .75rem;margin-left:1rem;font-size:.9rem;cursor:pointer;transition:border-color .2s ease}.connect-button[_ngcontent-%COMP%]:hover{border-color:var(--text-color)}.now-playing[_ngcontent-%COMP%]{margin-bottom:1.5rem}.now-playing-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:16px;opacity:1;font-size:20px;font-weight:500;color:var(--text-color)}.track-container[_ngcontent-%COMP%]{display:flex;align-items:center;background:#0003;border-radius:8px;padding:16px;max-width:650px}.album-art[_ngcontent-%COMP%]{width:150px;height:150px;margin-right:16px;border-radius:4px;overflow:hidden}.album-art[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.track-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-between;min-width:0}.track-name[_ngcontent-%COMP%]{font-weight:500;font-size:16px;margin-bottom:8px;color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.track-artist[_ngcontent-%COMP%]{font-size:14px;opacity:.8;margin-bottom:8px;color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.track-album[_ngcontent-%COMP%]{font-size:14px;opacity:.6;margin-bottom:16px;color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.track-progress[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px;width:100%}.progress-bar-container[_ngcontent-%COMP%]{width:100%;height:4px;background-color:#ffffff1a;border-radius:2px;overflow:hidden;margin-bottom:3px}.progress-bar[_ngcontent-%COMP%]{height:100%;background-color:#f4d03f}.time-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;opacity:.6;margin-top:2px;color:var(--text-color)}.spotify-link[_ngcontent-%COMP%]{display:inline-block;color:#f4d03f;font-size:14px;text-decoration:none;opacity:.9;transition:opacity .2s}.spotify-link[_ngcontent-%COMP%]:hover{opacity:1}"]})}}return r})();export{F as a};
