import{a as $}from"./chunk-LREVGLKU.js";import{$ as T,Ba as P,Fa as M,Ia as y,K as b,M as p,O as C,Oa as c,Pa as A,Qa as r,Ra as i,Sa as m,T as w,Ta as E,Ua as I,Va as d,Za as s,_ as S,_a as h,aa as f,ba as g,n as v,nb as U,ob as O,va as x,w as k,xa as a,y as l}from"./chunk-4GZFMHVW.js";var _={production:!1,apiUrl:"http://localhost:3000/backend",weatherApiUrl:"http://localhost:3000/backend/weather",githubApiUrl:"http://localhost:3000/backend/github",spotifyApiUrl:"http://localhost:3000/backend/spotify",discordApiUrl:"http://localhost:3000/backend/discord"};var V=(()=>{class e{constructor(t){this.http=t,this.apiUrl=_.apiUrl+"/spotify",this.developerActivityUrl=this.apiUrl+"/developer-activity",this.isAuthenticated=!1,new URLSearchParams(window.location.search).get("auth_success")==="true"&&(this.isAuthenticated=!0,window.history.replaceState({},document.title,window.location.pathname))}getNowPlaying(){return this.http.get(`${this.apiUrl}/current-track`).pipe(p(()=>this.isAuthenticated=!0),l(this.handleError))}getRecentlyPlayed(t=10){return this.http.get(`${this.apiUrl}/recently-played`,{params:{limit:t.toString()}}).pipe(p(()=>this.isAuthenticated=!0),l(this.handleError))}getTopItems(t,n="medium_term",o=10){return this.http.get(`${this.apiUrl}/top/${t}`,{params:{time_range:n,limit:o.toString()}}).pipe(p(()=>this.isAuthenticated=!0),l(this.handleError))}getPlaylists(t=20,n=0){return this.http.get(`${this.apiUrl}/playlists`,{params:{limit:t.toString(),offset:n.toString()}}).pipe(p(()=>this.isAuthenticated=!0),l(this.handleError))}getPlaylistTracks(t,n=20,o=0){return this.http.get(`${this.apiUrl}/playlists/${t}/tracks`,{params:{limit:n.toString(),offset:o.toString()}}).pipe(p(()=>this.isAuthenticated=!0),l(this.handleError))}getWorkHoursAnalysis(){return this.http.get(`${this.developerActivityUrl}/work-hours-analysis`).pipe(l(this.handleError))}getProductivityCorrelation(){return this.http.get(`${this.developerActivityUrl}/productivity-correlation`).pipe(l(this.handleError))}getListeningPatterns(t="week"){return this.http.get(`${this.developerActivityUrl}/listening-patterns`,{params:{period:t}}).pipe(l(this.handleError))}authorize(){window.location.href=`${_.apiUrl}/spotify/auth/login`}checkAuthentication(){return this.http.get(`${this.apiUrl}/current-user`).pipe(p(()=>this.isAuthenticated=!0),l(t=>(this.isAuthenticated=!1,v(t))))}logout(){return this.http.get(`${this.apiUrl}/auth/logout`).pipe(p(()=>this.isAuthenticated=!1),l(this.handleError))}handleError(t){return t.status===0?console.error("An error occurred:",t.error):t.status===401?console.error("Authentication required:",t.error):console.error(`Backend returned code ${t.status}, body was:`,t.error),v(t)}static{this.\u0275fac=function(n){return new(n||e)(w($))}}static{this.\u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function N(e,u){e&1&&(r(0,"div",3),f(),r(1,"svg",4)(2,"path",5),m(3,"animateTransform",6),i()(),g(),r(4,"span"),s(5,"Loading current track..."),i()())}function j(e,u){if(e&1){let t=E();r(0,"div",3),f(),r(1,"svg",4),m(2,"path",7),i(),g(),r(3,"span"),s(4,"Authentication required"),i(),r(5,"button",8),I("click",function(){S(t);let o=d();return T(o.authenticate())}),s(6,"Connect"),i()()}}function G(e,u){if(e&1&&(r(0,"div",9),f(),r(1,"svg",4),m(2,"path",10),i(),g(),r(3,"span"),s(4),i()()),e&2){let t=d();a(4),h(t.error)}}function Z(e,u){e&1&&(r(0,"div",3),f(),r(1,"svg",4),m(2,"path",11),i(),g(),r(3,"span"),s(4,"Not currently playing anything"),i()())}function q(e,u){if(e&1&&(r(0,"div",28),m(1,"img",29),i()),e&2){let t=d(2);a(),c("src",t.currentTrack.album.images[0].url,x)("alt",t.currentTrack.album==null?null:t.currentTrack.album.name)}}function D(e,u){if(e&1&&(r(0,"div",30),s(1),i()),e&2){let t=d(2);a(),h(t.currentTrack.album.name)}}function F(e,u){if(e&1&&(r(0,"a",31),s(1," Open in Spotify "),i()),e&2){let t=d(2);c("href",t.currentTrack.external_urls.spotify,x)}}function B(e,u){if(e&1&&(r(0,"div",12)(1,"div",13),f(),r(2,"svg",4),m(3,"path",14),i(),g(),r(4,"span"),s(5,"Now Playing"),i()(),r(6,"div",15),y(7,q,2,2,"div",16),r(8,"div",17)(9,"div",18),s(10),i(),r(11,"div",19),s(12),i(),y(13,D,2,1,"div",20),r(14,"div",21)(15,"div",22),m(16,"div",23),i(),r(17,"div",24)(18,"span",25),s(19),i(),r(20,"span",26),s(21),i()()(),y(22,F,2,1,"a",27),i()()()),e&2){let t=d();a(7),c("ngIf",(t.currentTrack.album==null?null:t.currentTrack.album.images)&&t.currentTrack.album.images.length>0),a(3),h(t.currentTrack.name),a(2),h(t.getArtistNames(t.currentTrack.artists)),a(),c("ngIf",t.currentTrack.album),a(3),A("width",t.progressPercentage,"%"),a(3),h(t.formatTime(t.currentTrack.progress_ms)),a(2),h(t.formatTime(t.currentTrack.duration_ms)),a(),c("ngIf",t.currentTrack.external_urls==null?null:t.currentTrack.external_urls.spotify)}}var rt=(()=>{class e{constructor(t){this.spotifyService=t,this.currentTrack=null,this.loading=!0,this.error=null,this.progressPercentage=0,this.refreshInterval=1e4,this.subscription=null}ngOnInit(){this.loadCurrentTrack(),this.subscription=k(this.refreshInterval).pipe(b(()=>this.spotifyService.getNowPlaying())).subscribe({next:t=>this.updateCurrentTrack(t),error:t=>{console.error("Error refreshing current track:",t)}})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}authenticate(){window.location.href=`${window.location.origin.replace("4202","3000")}/backend/spotify/auth/login`}loadCurrentTrack(){this.loading=!0,this.error=null,this.spotifyService.getNowPlaying().subscribe({next:t=>{t?this.updateCurrentTrack(t):this.error="No track currently playing",this.loading=!1},error:t=>{console.error("Error loading current track:",t),t.status===401?this.error="401: Authentication required":this.error="Failed to load current track",this.loading=!1}})}updateCurrentTrack(t){t?t.item?(this.currentTrack=t.item,this.currentTrack.progress_ms=t.progress_ms||0,this.progressPercentage=t.progress_ms/t.item.duration_ms*100):t.name&&t.artists?(this.currentTrack=t,this.currentTrack.progress_ms=t.progress_ms||0,this.progressPercentage=t.progress_ms/t.duration_ms*100):(this.currentTrack=null,this.progressPercentage=0):(this.currentTrack=null,this.progressPercentage=0)}getArtistNames(t){return!t||t.length===0?"":t.map(n=>n.name).join(", ")}formatTime(t){if(!t)return"0:00";let n=Math.floor(t/1e3),o=Math.floor(n/60),H=n%60;return`${o}:${H.toString().padStart(2,"0")}`}static{this.\u0275fac=function(n){return new(n||e)(P(V))}}static{this.\u0275cmp=M({type:e,selectors:[["app-spotify-player"]],decls:5,vars:5,consts:[["class","status-item",4,"ngIf"],["class","status-item error",4,"ngIf"],["class","now-playing",4,"ngIf"],[1,"status-item"],["viewBox","0 0 24 24","width","24","height","24",1,"icon"],["fill","currentColor","d","M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"],["attributeName","transform","attributeType","XML","type","rotate","from","0 12 12","to","360 12 12","dur","1s","repeatCount","indefinite"],["fill","currentColor","d","M12,2C6.477,2 2,6.477 2,12C2,17.523 6.477,22 12,22C17.523,22 22,17.523 22,12C22,6.477 17.523,2 12,2M12,4C16.418,4 20,7.582 20,12C20,16.418 16.418,20 12,20C7.582,20 4,16.418 4,12C4,7.582 7.582,4 12,4M15,12L11,16V8L15,12Z"],[1,"connect-button",3,"click"],[1,"status-item","error"],["fill","currentColor","d","M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"],["fill","currentColor","d","M12,3V12.26C11.5,12.09 11,12 10.5,12C8.56,12 7,13.56 7,15.5C7,17.44 8.56,19 10.5,19C12.44,19 14,17.44 14,15.5V6H18V3H12Z"],[1,"now-playing"],[1,"now-playing-header"],["fill","currentColor","d","M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M10,16.5L16,12L10,7.5V16.5Z"],[1,"track-container"],["class","album-art",4,"ngIf"],[1,"track-info"],[1,"track-name"],[1,"track-artist"],["class","track-album",4,"ngIf"],[1,"track-progress"],[1,"progress-bar-container"],[1,"progress-bar"],[1,"time-info"],[1,"current-time"],[1,"duration"],["target","_blank","class","spotify-link",3,"href",4,"ngIf"],[1,"album-art"],[3,"src","alt"],[1,"track-album"],["target","_blank",1,"spotify-link",3,"href"]],template:function(n,o){n&1&&y(0,N,6,0,"div",0)(1,j,7,0,"div",0)(2,G,5,1,"div",1)(3,Z,5,0,"div",0)(4,B,23,9,"div",2),n&2&&(c("ngIf",o.loading),a(),c("ngIf",o.error&&o.error.includes("401")),a(),c("ngIf",o.error&&!o.error.includes("401")),a(),c("ngIf",!o.loading&&!o.error&&!o.currentTrack),a(),c("ngIf",!o.loading&&!o.error&&o.currentTrack))},dependencies:[O,U],styles:[".connect-button[_ngcontent-%COMP%]{background-color:transparent;color:var(--accent-color);border:1px solid var(--border-color);padding:.25rem .75rem;margin-left:1rem;font-size:.9rem;cursor:pointer;transition:border-color .2s ease}.connect-button[_ngcontent-%COMP%]:hover{border-color:var(--text-color)}.now-playing[_ngcontent-%COMP%]{margin-bottom:1.5rem}.now-playing-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:16px;opacity:1;font-size:20px;font-weight:500;color:var(--text-color)}.track-container[_ngcontent-%COMP%]{display:flex;align-items:center;background:#0003;border-radius:8px;padding:16px;max-width:650px}.album-art[_ngcontent-%COMP%]{width:150px;height:150px;margin-right:16px;border-radius:4px;overflow:hidden}.album-art[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.track-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;justify-content:space-between;min-width:0}.track-name[_ngcontent-%COMP%]{font-weight:500;font-size:16px;margin-bottom:8px;color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.track-artist[_ngcontent-%COMP%]{font-size:14px;opacity:.8;margin-bottom:8px;color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.track-album[_ngcontent-%COMP%]{font-size:14px;opacity:.6;margin-bottom:16px;color:var(--text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.track-progress[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:4px;width:100%}.progress-bar-container[_ngcontent-%COMP%]{width:100%;height:4px;background-color:#ffffff1a;border-radius:2px;overflow:hidden;margin-bottom:3px}.progress-bar[_ngcontent-%COMP%]{height:100%;background-color:#f4d03f}.time-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;opacity:.6;margin-top:2px;color:var(--text-color)}.spotify-link[_ngcontent-%COMP%]{display:inline-block;color:#f4d03f;font-size:14px;text-decoration:none;opacity:.9;transition:opacity .2s}.spotify-link[_ngcontent-%COMP%]:hover{opacity:1}"]})}}return e})();export{_ as a,V as b,rt as c};
